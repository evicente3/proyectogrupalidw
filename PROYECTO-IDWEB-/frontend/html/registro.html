<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8" />
    <title>Registro - Vortex Tech</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="../css/estiloshome.css" />
    <script defer src="../js/auth-ui.js"></script>

    <script>

        async function enviarRegistro(event) {
            event.preventDefault();

            const form = document.getElementById("form-registro");
            const nombre = form.nombre.value.trim();
            const email = form.email.value.trim();
            const password = form.password.value.trim();
            const password2 = form.password2.value.trim();
            const msgDiv = document.getElementById("registro-mensaje");

            msgDiv.textContent = "";
            msgDiv.className = "form-mensaje";

            // Validaciones en cliente
            if (!nombre || !email || !password || !password2) {
                msgDiv.textContent = "Por favor completa todos los campos.";
                msgDiv.classList.add("error");
                return;
            }

            if (password !== password2) {
                msgDiv.textContent = "Las contraseñas no coinciden.";
                msgDiv.classList.add("error");
                return;
            }

            if (password.length < 6) {
                msgDiv.textContent = "La contraseña debe tener al menos 6 caracteres.";
                msgDiv.classList.add("error");
                return;
            }

            try {
                const body = new FormData();
                body.append("nombre", nombre);
                body.append("email", email);
                body.append("password", password);

                const resp = await fetch(`${API_BASE}/registro`, {
                    method: "POST",
                    body,
                    credentials: "include",
                });

                let data;
                try {
                    data = await resp.json();
                } catch (e) {
                    console.error("Error parseando JSON de /registro", e);
                    msgDiv.textContent = "Respuesta no válida del servidor.";
                    msgDiv.classList.add("error");
                    return;
                }

                console.log("Respuesta /registro:", resp.status, data);

                if (!resp.ok || !data.ok) {
                    msgDiv.textContent = data.msg || "Error al registrar usuario.";
                    msgDiv.classList.add("error");
                    return;
                }

                msgDiv.textContent = data.msg || "Registro correcto. Ahora puedes iniciar sesión.";
                msgDiv.classList.add("ok");

                setTimeout(() => {
                    window.location.href = "login.html";
                }, 1500);
            } catch (e) {
                console.error("Error en fetch /registro", e);
                msgDiv.textContent = "Error de conexión con el servidor.";
                msgDiv.classList.add("error");
            }
        }

        document.addEventListener("DOMContentLoaded", () => {
            const form = document.getElementById("form-registro");
            if (form) {
                form.addEventListener("submit", enviarRegistro);
            }
        });
    </script>

    <style>
        main.auth-main {
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        .auth-card {
            background: #ffffff;
            border-radius: 12px;
            padding: 30px;
            max-width: 450px;
            width: 100%;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.05);
        }
        .auth-card h1 {
            margin-top: 0;
            margin-bottom: 20px;
            text-align: center;
            color: #1a73e8;
        }
        .auth-card label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
        }
        .auth-card input {
            width: 100%;
            padding: 10px;
            margin-bottom: 15px;
            border-radius: 6px;
            border: 1px solid #ccc;
            box-sizing: border-box;
        }
        .auth-card button {
            width: 100%;
            padding: 10px;
            border-radius: 6px;
            border: none;
            background-color: #00C6FF;
            color: #1a73e8;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }
        .auth-card button:hover {
            background-color: #00A6D6;
        }
        .form-mensaje {
            margin-top: 10px;
            font-size: 0.9em;
        }
        .form-mensaje.error {
            color: #c62828;
        }
        .form-mensaje.ok {
            color: #2e7d32;
        }
        .auth-extra {
            margin-top: 15px;
            text-align: center;
            font-size: 0.9em;
        }
        .auth-extra a {
            color: #1a73e8;
            text-decoration: none;
        }
        .auth-extra a:hover {
            text-decoration: underline;
        }
    </style>
</head>
<body>
    <header class="main-header">
        <div class="logo">Vortex<span class="logo-pro">Tech</span></div>
        <nav class="main-nav">
            <ul>
                <a href="home.html">Inicio</a>
                <a href="celulares.html">Celulares</a>
                <a href="laptops.html">Laptops</a>
                <a href="tablets.html">Tablets</a>
                <a href="televisores.html">Televisores</a>
                <a href="about.html">Quiénes Somos</a>
                <a href="registro.html">Registro</a>
            </ul>
        </nav>
<a href="login.html" class="header-cta-button" id="btn-login-header">Login</a>
    </header>

    <main class="auth-main">
        <section class="auth-card" aria-labelledby="titulo-registro">
            <h1 id="titulo-registro">Crear cuenta</h1>
            <form id="form-registro" novalidate>
                <label for="nombre">Nombre completo</label>
                <input
                    type="text"
                    id="nombre"
                    name="nombre"
                    required
                    minlength="2"
                    placeholder="Tu nombre"
                />

                <label for="email">Correo electrónico</label>
                <input
                    type="email"
                    id="email"
                    name="email"
                    required
                    autocomplete="email"
                    placeholder="ejemplo@correo.com"
                />

                <label for="password">Contraseña</label>
                <input
                    type="password"
                    id="password"
                    name="password"
                    required
                    minlength="6"
                    autocomplete="new-password"
                    placeholder="Mínimo 6 caracteres"
                />

                <label for="password2">Repetir contraseña</label>
                <input
                    type="password"
                    id="password2"
                    name="password2"
                    required
                    minlength="6"
                    autocomplete="new-password"
                    placeholder="Repite tu contraseña"
                />

                <button type="submit">Registrarme</button>
                <div id="registro-mensaje" class="form-mensaje" aria-live="polite"></div>
            </form>
            <div class="auth-extra">
                ¿Ya tienes cuenta?
                <a href="login.html">Inicia sesión aquí</a>
            </div>
        </section>
    </main>
    <script>
  initHeaderButton();
</script>

</body>

</html>
